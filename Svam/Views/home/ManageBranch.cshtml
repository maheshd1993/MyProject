@{
    ViewBag.Title = "ManageBranch";
    Layout = "~/Views/Shared/_LayoutSiteMaster.cshtml";
}
@{
    var al = TempData["success"];
    var alchk = TempData["alert"];
}

<div class="maincontainer">
    <div class="col-sm-12">

        <div class="panel panel-default">
            <div class="panel-heading">
                <i class="fa fa-th-list" aria-hidden="true"></i> Manage Branch
                <div class="rightbtntop">
                    <a href="#" class="addbtn" style="width:100%;" data-toggle="modal" data-target="#addbranch"><i aria-hidden="true" class="fa fa-plus"></i> Create Branch</a>
                </div>

            </div>
            <div class="panel-body">

                <div class="col-sm-12 padd0">
                    <div class="table-responsive">
                        <table id="dest" class="table table-striped table table-hover tabledata table-bordered">
                            <thead>
                                <tr>
                                    <th width="4%" class="noimg padd0" style="padding: 10px 0px;">Sr no.</th>
                                    <th width="12%">Branch Name </th>
                                    <th width="5%">Branch Code </th>
                                    <th width="12%">Email ID:-</th>
                                    <th width="12%">Website :-</th>
                                    <th width="8%">Country:-</th>
                                    <th width="8%">TIN No :-</th>
                                    <th width="8%">CST No. :</th>
                                    <th width="8%">PIN Code:-</th>
                                    <th width="12%" class="noimg">Action</th>

                                </tr>
                            </thead>
                            <tbody>
                                @{int i = 1;}
                                @foreach (var item in Model.branchModelList)
                                {
                               
                                  <tr>
                                    <td>@i</td>
                                    <td>@item.BranchName</td>
                                      <td>@item.BranchCode</td>
                                    <td>@item.EmailId</td>
                                    <td>@item.website</td>
                                    <td>@item.EmailId</td>
                                    <td>@item.TinNo</td>
                                    <td>@item.CstNo</td>
                                    <td>@item.Pincode</td>
                                    <td>
                                        <a href="#" title="view Details" class="viewbtn viewdetailsinfo" data-toggle="modal" data-id="@item.Id" data-target="#BranchdetailsInfo">Details</a>
                                        <a href="#" class="editbtn" onclick="UpdateQTdata(@item.Id)" title="Edit Branch" data-toggle="modal" data-target="#addbranch"> Edit</a> 
                                        @*<a href="#" title="Delet Branch" class="dltrow">Delete</a> *@
                                    </td>
                                </tr>
                                    i++;
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-sm-12">
                </div>

            </div>
        </div>


    </div>
    <!-- end item details -->

</div>


<div id="BranchdetailsInfo" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Add Branch</h4>
            </div>
            <div class="modal-body over-hidden">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="table-responsive">
                            <table class="table table-bordered modaltable">

                                <tbody>
                                    <tr>
                                        <td width="150" class="lefttd">Branch Name</td>
                                        <td width="70%"><span id="spnBranchName"></span></td>
                                    </tr>
                                     <tr>
                                        <td width="150" class="lefttd">Branch Code</td>
                                        <td width="70%"><span id="spnBranchCode"></span></td>
                                    </tr>
                                    <tr>
                                        <td class="lefttd">Address  :</td>
                                        <td><span id="spnAddress"></span> </td>
                                    </tr>
                                    <tr>
                                        <td class="lefttd">Country </td>
                                        <td><span id="spnCountry"></span></td>
                                    </tr>
                                    <tr>
                                        <td class="lefttd">State </td>
                                        <td><span id="spnState"></span></td>
                                    </tr>
                                    <tr>
                                        <td class="lefttd">City </td>
                                        <td><span id="spnCity"></span></td>
                                    </tr>
                                    <tr>
                                        <td class="lefttd">PIN Code :</td>
                                        <td><span id="spnPincode"></span></td>
                                    </tr>
                                    
                                    <tr>
                                        <td class="lefttd">Contact Person:</td>
                                        <td><span id="spnContact"></span></td>
                                    </tr>

                                    <tr>
                                        <td class="lefttd">Email ID</td>
                                        <td><span id="spnEmail"></span></td>
                                    </tr>

                                    <tr>
                                        <td class="lefttd">Website :</td>
                                        <td><span id="spnwebsite"></span></td>
                                    </tr>
                                    <tr>
                                        <td class="lefttd">TIN No</td>
                                        <td><span id="spnTinNo"></span></td>
                                    </tr>
                                    <tr>
                                        <td class="lefttd">Service Tax </td>
                                        <td><span id="spnServiceTax"></span></td>
                                    </tr>
                                    <tr>
                                        <td class="lefttd">CST No</td>
                                        <td><span id="spnCstNo"></span></td>
                                    </tr>
                                    <tr>
                                        <td class="lefttd">PAN No.  :</td>
                                        <td><span id="spnPanNo"></span></td>
                                    </tr>

                                    <tr>
                                        <td class="lefttd">Excise Reg No </td>
                                        <td><span id="spnExciseRegNo"></span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>



@model Svam.Models.ManageBranchModel
<div id="addbranch" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Create Branch</h4>
            </div>
            <div class="modal-body over-hidden">
                <div class="row">
                    <div class="col-sm-12">
                        @using (Html.BeginForm("ManageBranch", "home", FormMethod.Post, new { @class = "form-horizontal" }))
                        {
                        

                            <div class="form-group">
                                <label class="control-label col-sm-3" for="cname">Branch Name:-</label>
                                <div class="col-sm-8">
                                   @Html.TextBoxFor(em => em.BranchName, new { @class = "form-control" })
                                   @Html.ValidationMessageFor(em => em.BranchName)
                                    <input type="hidden" id="Id" name="Id" />
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="address">Branch Code:-</label>
                                <div class="col-sm-8">
                                     @Html.TextBoxFor(em => em.BranchCode, new { @class = "form-control caps",@Minlength="3",@Maxlength="3",@onkeypress="return onlyAlphabets(event,this);" })
                                    @Html.ValidationMessageFor(em => em.BranchCode)
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="address">Address:-</label>
                                <div class="col-sm-8">
                                     @Html.TextBoxFor(em => em.Address, new { @class = "form-control" })
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="pcode">Country:-</label>
                                <div class="col-sm-8">
                                    <select id="DdlCountry" name="CountryId" class="form-control" required="required">
                                        <option></option>
                                    </select>
                                </div>
                            </div>
                           
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="state">State:-</label>
                                <div class="col-sm-8">
                                     <select id="DdlState" name="StateId" class="form-control" required="required"> 
                                         <option></option>
                                     </select>
                                </div>
                            </div>
                             <div class="form-group">
                                <label class="control-label col-sm-3" for="city">City:-</label>
                                <div class="col-sm-8">
                                    <select id="DDlCity" name="CityId" class="form-control" required="required"> 
                                         <option></option>
                                     </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-sm-3" for="pcode">PIN Code:-</label>
                                <div class="col-sm-8">
                                     @Html.TextBoxFor(em => em.Pincode, new { @class = "form-control" })
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="pcode">Contact Person:-</label>
                                <div class="col-sm-8">
                                     @Html.TextBoxFor(em => em.ContactPerson, new { @class = "form-control" })
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-sm-3" for="email">Email ID:-</label>
                                <div class="col-sm-8">
                                     @Html.TextBoxFor(em => em.EmailId, new { @class = "form-control" })
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-sm-3" for="website">Website :-</label>
                                <div class="col-sm-8">
                                     @Html.TextBoxFor(em => em.website, new { @class = "form-control" })
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="tinno">TIN No :-</label>
                                <div class="col-sm-8">
                                     @Html.TextBoxFor(em => em.TinNo, new { @class = "form-control" })
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-sm-3" for="stax">Service Tax :-</label>
                                <div class="col-sm-8">
                                     @Html.TextBoxFor(em => em.ServiceText, new { @class = "form-control" })
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="cstno">CST No. :-</label>
                                <div class="col-sm-8">
                                    @Html.TextBoxFor(em => em.CstNo, new { @class = "form-control" })
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="panno">Pan No. :-</label>
                                <div class="col-sm-8">
                                    @Html.TextBoxFor(em => em.PanNo, new { @class = "form-control" })
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-3" for="regno">Excise Reg No :-</label>
                                <div class="col-sm-8">
                                    @Html.TextBoxFor(em => em.ExciseRegNo, new { @class = "form-control" })
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-sm-3" for="regno"></label>
                                <div class="col-sm-8">
                                    <input type="submit" class="btn mainbtn2" value="Submit">
                                    <input type="button" class="btn mainbtn" value="Cancel">
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>
<!--Start Loader....-->
<div class="loaderimg" style="display: none" id="loader">

    <div class="loadingoverlay">
        <div class="loadingoverlayContent" style="text-align: center;">
            Please wait. We are processing your request.<br>
            <br>
            <img src="@Url.Content("~/Content/Loader/loading.gif")" id="Img1" alt="Processing...">
        </div>
    </div>
</div>


@section Scripts {
    
    @System.Web.Optimization.Scripts.Render("~/bundles/jqueryval")
    @System.Web.Optimization.Scripts.Render("~/bundles/jqueryui")
    @System.Web.Optimization.Styles.Render("~/Content/themes/base/css")

    <script>
        $(document).ready(function () {
            BindDDLCountry();
        });
        function UpdateQTdata(id) {
            $.ajax({
                type: "GET",
                url: '@Url.Action("UpdateBranchById", "home")',
                data: { id: id },
                error: function (xhr, status, error) {
                    $(".loaderimg").hide();
                },
                success: function (JSONdata) {
                    $("#Id").val(JSONdata.Id);
                    $("#BranchName").val(JSONdata.BranchName);
                    jQuery('#BranchCode').val(JSONdata.BranchCode);
                    jQuery('#BranchCode').attr("disabled", "disabled");
                    $("#Address").val(JSONdata.Address);                    
                    $("#Pincode").val(JSONdata.pincode);
                    $("#ContactPerson").val(JSONdata.ContactPerson);
                    $("#EmailId").val(JSONdata.EmailId);
                    $("#website").val(JSONdata.Website);
                    $("#TinNo").val(JSONdata.TinNo);
                    $("#ServiceText").val(JSONdata.ServiceTax); 
                    $("#CstNo").val(JSONdata.CSTNo);
                    $("#PanNo").val(JSONdata.PanNo);
                    $("#ExciseRegNo").val(JSONdata.ExciseRegNo);
                    $('#DdlCountry').val(JSONdata.CountryId);
                    if (JSONdata.CountryId != '') {
                        BindDDLState(JSONdata.CountryId);
                        $('#DdlState').val(JSONdata.stateid);
                    }
                    if (JSONdata.stateid != '') {
                        BindDDLCity(JSONdata.stateid);
                        
                        $('#DDlCity').val(JSONdata.cityId);
                    }
                },
                beforeSend: function () {
                    if (id != 0)
                        $('.loaderimg').show();

                    else
                        return false;
                },
                complete: function () {
                    $(".loaderimg").hide();
                }
            });
        }

        jQuery('.addTaxGroup').click(function ()
        {
            $("#Id").val('');
            $("#TaxgroupName").val('');
        });

        function onlyAlphabets(e, t) {
            try {
                if (window.event) {
                    var charCode = window.event.keyCode;
                }
                else if (e) {
                    var charCode = e.which;
                }
                else { return true; }
                if ((charCode > 64 && charCode < 91) || (charCode > 96 && charCode < 123))
                    return true;
                else
                    return false;
            }
            catch (err) {
                alert(err.Description);
            }
        }


        var mas = '@al';
        var chkmsg = '@alchk';
        if (mas != '') {
            swal({ title: "Thank you!", text: mas, imageUrl: "/Scripts/SweetAlert/thumbs-up.jpg" });
        }
        if (chkmsg != '') {
            alert(chkmsg);
        }
        
        // Start Bind Country & State And City

        function BindDDLCountry() {
            $.get('/master/BindDDlCountry', null, function (data) { chkBindDDLCountry(data); });
        }
        function chkBindDDLCountry(abc) {
            var CountryId = '@Model.CountryId';
        var data = "";
        data += "<option value= >--Select Country--</option>";
        for (var it in abc) {
            data += "<option value=" + abc[it].Id + " >" + abc[it].CountryName + "</option>";
        }
        $('#DdlCountry').html(data).val(CountryId);
        if (CountryId != '') {
            BindDDLState(CountryId);
        }
    }

    jQuery('#DdlCountry').change(function () {
        var Countryid = jQuery(this).val();
        if (Countryid != '') {
            BindDDLState(Countryid);
        }
    });

    jQuery('#DdlState').change(function () {
        var Stateid = jQuery(this).val();
        if (Stateid != '') {
            BindDDLCity(Stateid);
        }
    });


    function BindDDLState(Countryid) {
        var Countryid = Countryid;
        $.get('/master/BindDDlState', { CountryID: Countryid }, function (data) { chkBindDDLState(data); });
    }
    function chkBindDDLState(abc) {
        var data = "";
        data += "<option value= >--Select State--</option>";
        for (var it in abc) {
            data += "<option value=" + abc[it].Id + " >" +
             abc[it].StateName + "</option>";
        }
        $('#DdlState').html(data);
    }

    function BindDDLCity(stateId) {
        var Stateid = stateId;
        if (Stateid != '') {
            $.get('/master/BindDDlCity', { StateID: Stateid }, function (data) { chkBindDDLCity(data); });
        }
    }
    function chkBindDDLCity(abc) {
        var data = "";
        data += "<option value= >--Select City--</option>";
        for (var it in abc) {
            data += "<option value=" + abc[it].Id + " >" +
             abc[it].CityName + "</option>";
        }
        $('#DDlCity').html(data);
    }

    </script>

    <script>
        jQuery('.viewdetailsinfo').click(function () {
            var id = jQuery(this).data('id');
            if (id != '') {
                $.ajax({
                    type: "GET",
                    url: '@Url.Action("BranchDetailsInfo", "home")',
                data: { id: id },
                error: function (xhr, status, error) {
                    $(".loaderimg").hide();
                },
                success: function (JSONdata) {
                    $("#spnBranchName").text(JSONdata[0].BranchName);
                    $("#spnBranchCode").text(JSONdata[0].BranchCode);
                    $("#spnAddress").text(JSONdata[0].Address);
                    $("#spnCountry").text(JSONdata[0].CountryName);
                    $("#spnState").text(JSONdata[0].StateName);
                    $("#spnCity").text(JSONdata[0].CityName);
                    $("#spnPincode").text(JSONdata[0].Pincode);
                    $("#spnContact").text(JSONdata[0].ContactPerson);
                    $("#spnEmail").text(JSONdata[0].EmailId);
                    $("#spnwebsite").text(JSONdata[0].website);
                    $("#spnTinNo").text(JSONdata[0].TinNo);
                    $("#spnServiceTax").text(JSONdata[0].ServiceText);
                    $("#spnCstNo").text(JSONdata[0].CstNo);
                    $("#spnPanNo").text(JSONdata[0].PanNo);
                    $("#spnExciseRegNo").text(JSONdata[0].ExciseRegNo);
                },
                beforeSend: function () {
                    if (id != 0)
                        $('.loaderimg').show();

                    else
                        return false;
                },
                complete: function () {
                    $(".loaderimg").hide();
                }
                 });
            }
        });
    </script>
}

<script src="~/Scripts/jquery-1.7.1.min.js"></script>